<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<?php
/**
 * Category view template
 *
 * @see Mage_Catalog_Block_Category_View
 */
?>

<?php
/*
 * @TODO: Refactoring / cleanup required post-MVP launch:
 * - This file is littered with inline styles that need to be removed
 * - The overall structure including choice of markup needs to be refined
 * - See home page event index for example, and MGN-883
 */
?>
<?php
    $_helper    = $this->helper('catalog/output');
    $_category  = $this->getCurrentCategory();
    $_imgHtml   = '';
    $timer = 'category';
    
    if ($_imgUrl = $_category->getImageUrl()) {
        $_imgHtml = '<div class="category-image"><img src="'.$_imgUrl.'" alt="'.$this->htmlEscape($_category->getName()).'" title="'.$this->htmlEscape($_category->getName()).'" /></div>';
        $_imgHtml = $_helper->categoryAttribute($_category, $_imgHtml, 'image');
    }
    
  	$defaultTimezone = date_default_timezone_get();
	$mageTimezone = Mage::getStoreConfig(Mage_Core_Model_Locale::XML_PATH_DEFAULT_TIMEZONE);
	date_default_timezone_set($mageTimezone);
	$now = now();
	date_default_timezone_set($defaultTimezone);
	
	$endcount_utc = strtotime($_category->getEventEndDate());
	$startcount_utc = strtotime($_category->getEventStartDate());
	$endcount_lc = date("F j, Y, G:i:s", $endcount_utc);
	$startcount_lc = date("F j, Y, G:i:s", $startcount_utc);
	
	if (strtotime($now) >= strtotime( $startcount_lc )){
		$timecount = $endcount_lc;
		$timerFlag = 'Ends in';
		$upComingFlag = 0;
	}else {
		$timecount = $startcount_lc;
		$timerFlag = 'Opens in';
		$upComingFlag = 1;
	}
	
?>
<section class="event-landing event-<?php echo ($upComingFlag ? 'upcoming' : 'current'); ?>">
    <?php echo $this->getMessagesBlock()->toHtml() ?>
    <?php
    $depts = $_category->getDepartments();
    $_attributes = array();
    $_attributes = explode(',',$depts);
    $allowAttrArray = array('boys','girls','moms_dads');
    ?>
    <?php if($this->isContentMode()): ?>
        <?php echo $this->getCmsBlockHtml() ?>

    <?php elseif($this->isMixedMode()): ?>
        <?php echo $this->getCmsBlockHtml() ?>
        <div class="plus-products"><?php echo $this->getProductListHtml() ?></div>

    <?php else: ?>
    <div class="plus-products"><?php echo $this->getProductListHtml() ?></div>
    <?php endif; ?>
    
    <!--
    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">stLight.options({publisher: "fa9539d4-b1db-40d3-9e2d-9e9a8dc98b42",onhover: false}); </script>
    <script>
    stWidget.addEntry({
    "service":"sharethis",
    "element":document.getElementById('st_sharethis_custom'),
    "url":"<?php echo $this->helper('core/url')->getCurrentUrl();?>",
    "title":"Totsy",
    "image":"<?php echo $_imgUrl; ?>"
    });
    </script>
    -->    
</section>
