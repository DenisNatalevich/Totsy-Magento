<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<?php
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?>
<?php
    $_productCollection=$this->getLoadedProductCollection();
    $_currentCategory = Mage::getSingleton('catalog/layer')->getCurrentCategory();
    $_helper = $this->helper('catalog/output');
    $defaultTimezone = date_default_timezone_get();
    $mageTimezone = Mage::getStoreConfig(Mage_Core_Model_Locale::XML_PATH_DEFAULT_TIMEZONE);
    date_default_timezone_set($mageTimezone);
    $now = now();
    date_default_timezone_set($defaultTimezone);
    if ( strtotime($now) >= strtotime($_currentCategory->getData('event_end_date')) || strtotime($now) < strtotime($_currentCategory->getData('event_start_date'))){
    $timeOutFlag = 1;
    } else {
       $timeOutFlag = 0;
    }
    if (!!Mage::registry('admin_preview_mode')) {
        $timeOutFlag = 0;
    }
?>
    <?php if( !$_productCollection->count() || $timeOutFlag ): ?>
    <?php else : ?>
    <div class="row">
        <div class="span12">
        <?php // Grid Only Mode ?>
        <?php $_collectionSize = $_productCollection->count() ?>
        <?php $_columnCount = 3; //for the elements number will be changed by the filter?>
    <?php //$_columnCount = $this->getColumnCount(); ?>
    <ul class="thumbnails">
    <?php $i=0; foreach ($_productCollection as $_product): ?>
        <?php if ( $_product->isSalable() ):?>
        <?php if ($i++%$_columnCount==0): ?>
        <?php endif ?>
        <span class="echoShare" 
            data-productname="<?php echo $_product->getName();?>"
            data-productcap="" 
            data-productdesc="<?php echo $_product->getShortDescription();?>" 
            data-imageclass="" 
            data-producturl="<?php echo $_product->getProductUrl(); ?>">
            <li class="item<?php if(($i-1)%$_columnCount==0): ?> first<?php elseif($i%$_columnCount==0): ?> last <?php endif; ?><?php echo ' '.str_replace(',',' ',$_product->getDepartments()) ?>" department="<?php echo str_replace(',',' ',$_product->getDepartments()) ?>" style="display:none;">
            </li>
        </span>
        <li class="span4">
            <div class="thumbnail" style="padding:0px; min-height:420px;">
                <a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize(308, 400)->keepFrame(FALSE); ?>" width="308px" height="361px" alt="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" /></a>
            <div class="caption">
            <h5 style="display:block; min-height:35px; width:195px; font-weight: normal; color: #636466; font-size: 13px;"><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></h5>
            <?php if($_product->getRatingSummary()): ?>
            <?php echo $this->getReviewsSummaryHtml($_product, 'short') ?>
            <?php endif; ?>
            <div style="float:right; width:95px; margin-top:-46px; text-align:right;  ">
            <?php echo $this->getPriceHtml($_product, true) ?>
            </div>
            <div class="clear"></div>
            
            </div>
          </div>
        </li>
    <?php if ($i%$_columnCount==0 || $i==$_collectionSize): ?>
        <?php endif ?>
        <?php endif;?>
    <?php endforeach ?>
    </ul>
    </div>
    </div>
    <?php foreach ($_productCollection as $_product): ?>
        <?php if ( !$_product->isSalable() ):?>
        <?php if ($i++%$_columnCount==0): ?>
            <ul class="products-grid">
                <?php endif ?>
                <li class="status status_sold_out item<?php if(($i-1)%$_columnCount==0): ?> first<?php elseif($i%$_columnCount==0): ?> last <?php endif; ?><?php echo ' '.str_replace(',',' ',$_product->getDepartments()) ?>" department="<?php echo str_replace(',',' ',$_product->getDepartments()) ?>">
                    <img id="out-of-stock" src="<?php echo $this->getSkinUrl('images/soldout.png');?>"/>
                        <span class="echoShare" 
                            data-productname="<?php echo $_product->getName();?>" 
                            data-productcap="" 
                            data-productdesc="<?php echo $_product->getDescription();?>"
                            data-imageclass="" 
                            sdata-producturl="<?php echo $_product->getProductUrl(); ?>">
                        </span>
                        <a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize(350,350); ?>" width="350px" height="350px" alt="<?php echo $this->stripTags($this->getImageLabel($_product, 'small_image'), null, true) ?>" /></a>
                        <div class="product-info">
                            <h2 class="product-name"><a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $this->stripTags($_product->getName(), null, true) ?>"><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></a></h2>
                            <?php if($_product->getRatingSummary()): ?>
                                <?php echo $this->getReviewsSummaryHtml($_product, 'short') ?>
                            <?php endif; ?>
                        <?php echo $this->getPriceHtml($_product, true) ?>
                        </div>
                </li>
            <?php if ($i%$_columnCount==0 || $i==$_collectionSize): ?>
            </ul>
            <?php endif ?>
        <?php endif;?>
        <?php endforeach ?>
        <script type="text/javascript">
            decorateGeneric($$('ul.products-grid'), ['odd','even','first','last'])
        </script>
        </div>
        <?php endif; ?>
    </div>
</div>