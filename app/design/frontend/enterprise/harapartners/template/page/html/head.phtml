<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<meta charset="utf-8" />
<title><?php echo $this->getTitle() ?></title>
<!--[if IE 8]>
  <meta http-equiv="x-ua-compatible" content="IE=8">
<![endif]-->
<meta name="description" content="<?php echo strip_tags(html_entity_decode($this->getDescription())) ?>" />
<meta name="keywords" content="<?php echo htmlspecialchars($this->getKeywords()) ?>" />
<meta name="sailthru.date" content="<?php echo date("r");?>" />
<meta name="sailthru.title" content="<?php echo ($this->getSailthruTitle()=='')?htmlspecialchars($this->getKeywords()):htmlspecialchars($this->getSailthruTitle()) ?>" />
<meta name="sailthru.tags" content="<?php echo ($this->getSailthruTags()=='')?htmlspecialchars($this->getKeywords()):htmlspecialchars($this->getSailthruTags()) ?>" />
<link rel="icon" href="<?php echo $this->getFaviconFile(); ?>" type="image/x-icon" />
<link rel="shortcut icon" href="<?php echo $this->getFaviconFile(); ?>" type="image/x-icon" />
<!--[if lt IE 7]>
<script type="text/javascript">
//<![CDATA[
    var BLANK_URL = '<?php echo $this->helper('core/js')->getJsUrl('blank.html') ?>';
    var BLANK_IMG = '<?php echo $this->helper('core/js')->getJsUrl('spacer.gif') ?>';
//]]>
</script>
<![endif]-->

<script type="text/javascript">

var shver='2.8.6';
var shpn= '';
var shpc= '';
var shpp= '';
var shpb= '';
var shpi= '';
var shps= '';
var shcv= '';
var shcq= '';
var shcp= '';

</script>

<?php

if( Mage::getSingleton('customer/session')->getCustomerId() && ($this->getRequest()->getActionName()!=="view" && $this->getRequest()->getControllerName()!=="catalog") &&  ($this->getRequest()->getActionName()!=="success" && $this->getRequest()->getControllerName()!=="checkout") ) {

    $customer_id = Mage::getSingleton('customer/session')->getCustomerId();

    //include the signer
    require("dev/sociablelabs/sociable_signer.php");

    // declare a path to the key
    $key_path = "dev/sociablelabs/sign_private_key";

    // declare RondavuData
    $rondavu_data = array (
        "config" =>  array ( "version" => "1.2" ),
        //information about the currently logged in user
        "user" => array (
            "id" => array (
                array ( "id" => $customer_id, "type" => "totsy" )
            ),
            // use tracking fields to have query params on click back. e.g. http=>//www.totsy.com?refId=user12345
            "tracking" => array (
                array (
                    "name" => "refId",
                    "value" => $customer_id
                )
            )
        ),
        "primary_mo" => array (
            "id" => array (
                array ( "id"=> "totsy", "type" => "site" )
            ),
            "name" => array (
                array ( "name" => "Totsy" )
            ),
            "url" => array (
                "detail" => "http://www.totsy.com",
                "picture" => array (
                    "primary" => "http://www.totsy.com/img/logo-125x77.png",
                    "primary_secure" => "https://www.totsy.com/img/logo-125x77.png"
                )
            )
        )
    );

    //sign it
    $socialable_labs_output = rondavu_sign($rondavu_data, $key_path);

?>

<?php if(isset($socialable_labs_output)) { ?>
<script type="text/javascript">
    var socialableLabsOutput = <?php echo $socialable_labs_output ?>;
</script>
<?php

    }
}

?>

<?php echo $this->getCssJsHtml() ?>
<?php echo $this->getChildHtml() ?>
<?php echo $this->helper('core/js')->getTranslatorScript() ?>
<?php echo $this->getIncludes() ?>