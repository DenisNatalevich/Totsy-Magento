<?php
/**
 * Harapartners
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Harapartners License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.Harapartners.com/license
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@Harapartners.com so we can send you a copy immediately.
 *
 */

$topNavDataObject = $this->getTopNavDataObject();
$categoryDataArray = $topNavDataObject->getData('category_product_complete_data'); 
$howMany = count($categoryDataArray);
?>
<h2><?php echo $topNavDataObject->getData('attr_text_label'); ?><span><?php echo ' ( '.$howMany.' Sales Found )';?></span></h2>

<?php foreach($categoryDataArray as $category):?>

<div class="events-div">

<?php 
	$timerParam = $category['prepare_timer'];
	$endcount_lc = $timerParam['endcount_lc'];
	$timer = $timerParam['timer'];
?>
	<a href="<?php echo Mage::getBaseUrl().$category['category_info']['url_path']; ?>"><h3 class="category-name"><?php echo $category['category_info']['name']; ?></h3></a>
	<div class="layer-timer">
		<p class="the-topnav-timer" id="time-layer-<?php echo $timer ?>"></p>					 
		<script type="text/javascript">
			jQuery("#time-layer-<?php echo $timer ?>").countdown({
				date: "<?php echo $endcount_lc; ?>", //Counting TO a date
				htmlTemplate: "<span>Ends in</span><span class='italic'> %{d} <span class=\"cd-time\">Days</span> %{h}<span class=\"cd-time\">:</span>%{m}<span class=\"cd-time\">:</span>%{s}<span class=\"cd-time\"></span></span>",

				onChange: function( event, timer ){
				},
				onComplete: function( event ){										
					jQuery(this).html("Completed");
					jQuery(this).parents('.events-div').hide();
				},
				leadingZero: true,
				direction: "down"
			});
		</script>
	</div>
	<p class="layer-description"><?php echo $category['category_info']['description']; ?></p>


		<div class="category-products">
		<ul class="products-grid">
			<?php $j=0; ?>
			<?php $nonSalableArray = array();?>
			<?php $i=0; foreach ($category['product_list'] as $_product): ?>
				<?php if ($_product['is_salable']==1): ?>
				<li class="item">
		        	<ul class="echoShare" 
					data-productname="<?php echo $_product['name'];?>"  
					data-productcap="" 
					data-productdesc="<?php echo $_product['description'];?>" 
					data-imageclass=""  
					sdata-producturl="<?php echo $_product['url_path']; ?>">
					</ul>
					<a href="<?php echo Mage::getBaseUrl().$_product['url_path']; ?>" title="<?php echo $_product['name']; ?>" class="product-image"><img src="<?php echo $_product['small_image']; ?>" width="125" height="125" alt="<?php echo $_product['name']; ?>" /></a>
						<a class="item-details" href="<?php echo Mage::getBaseUrl().$_product['url_path'] ?>" title="<?php echo $_product['name']; ?>"><h4 class="product-name"><?php echo $_product['name']; ?></h4>
							<?php //echo $this->getPriceHtml($_product, true) ?>
							<div class="price-box">
								<span class="regular-price" id="product-price-<?php echo $_product['entity_id']; ?>">
								<?php $price = (isset($_product['special_price']))?$_product['special_price']:$_product['price']?>
									<span class="price">$<?php echo number_format($price,2,'.',''); ?></span>
								</span>
							</div>
						</a>
				</li>
				<?php 
					$i++; 
					$j = $i;
					if ($i==6){
						break;
					}
				?>
				<?php else:?>
				<?php $nonSalableArray[] = $_product;?>
				<?php endif; ?>
			<?php endforeach; ?>
			<li class="item last btn viewAllEvents">
				<a href="<?php echo Mage::getBaseUrl().$category['category_info']['url_path']; ?>">
					<img src="<?php echo $this->getSkinUrl()?>images/btn-viewevents-bug.png" />
				</a>
			</li>
		</ul>

			<script type="text/javascript">decorateGeneric($$('ul.products-grid'), ['odd','even','first','last'])</script>
		</div>
	
	<div class='vuall'>View all items from <a href="<?php echo Mage::getBaseUrl().$category['category_info']['url_path']; ?>"><?php echo $category['category_info']['name']; ?></a></div>
	
</div>
<?php endforeach ?>